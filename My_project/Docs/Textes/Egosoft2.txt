Окей, давай по-взрослому: **никаких поведенческих деревьев в стиле AAA-докладов у Egosoft не видно.**
То, что доступно по скриптам и модам, очень уверенно указывает на **иерархию команд + конечные автоматы + эвент-система MD**, с горой хардкода и эвристик.

Ниже — разбор по уровням, с пометками «факт / вывод / гипотеза».

---

## 1. Что вообще видно из открытых материалов

### 1.1. Скрипты MSCI (X2/X3)

**Факты**

* Большая часть поведения кораблей реализована скриптами на MSCI, которые привязаны к командам типа *Buy ware*, *Attack all enemies* и т.п. ([Xfiles][1])
* Каждый скрипт — это просто последовательность инструкций с циклами `while`, `if`, `wait`, вызовами других скриптов и т.д. ([Xfiles][1])
* Есть разделение на:

  * **command scripts** — привязаны к пунктам меню (навигация, бой, торговля);
  * **support/general scripts** — более общие, вызываются командами; типичный пример: `!ship.command.follow.pl` лишь передаёт управление в `!ship.cmd.follow.std`. ([Xfiles][1])
* Скрипты могут быть:

  * привязаны к объектам (корабль, станция),
  * глобальными «процессами» (AL-плагины и прочее), которые висят в фоне. ([Xfiles][1])

**Вывод**

* Архитектура скриптов **иерархическая**: тонкий «командный» слой, который роутит в более общие реализации. Это очень похоже на **иерархический конечный автомат / иерархию задач**, а не на дерево поведения:

  * команда `FOLLOW` вызывает общую реализацию follow;
  * другие команды делают то же самое для других «режимов». ([Xfiles][1])

---

### 1.2. Artificial Life (AL plugins)

**Факты**

* AL-плагины — это глобальные фоновые MSCI-скрипты, которые периодически что-то делают в мире (патрули, ответные флоты, пиратские гильдии и т.п.). ([Xfiles][1])
* Они запускаются/останавливаются через меню **Artificial Life Settings**, но внутри — те же MSCI-процессы с таймерами и циклами. ([forum.egosoft.com][2])

**Вывод**

* На уровне «живого мира» архитектура — это **набор независимых сервисов**, каждый реализован как отдельный скриптовый процесс:

  * никакого центрового blackboard’а не видно снаружи;
  * каждый плагин сам опрашивает вселенную и принимает решения.
* Паттерн ближе всего к **«демоны + периодический тиковый апдейт»**, поверх базового движка.

---

### 1.3. Mission Director (MD)

**Факты**

* Mission Director — **подсистема**, которая интерпретирует XML-скрипты, основанные на структуре **Cues → Conditions → Actions → Libraries**. ([egosoft.com][3])
* MD-файлы загружаются при старте игры; используются не только для миссий, но и для других событий. ([egosoft.com][3])
* Документация подчёркивает event-подход: `cues`, `conditions`, `actions`, обширное использование библиотек для модульности. ([forum.egosoft.com][4])

**Вывод**

* MD — это **классическая ECA-система (Event–Condition–Action)** с библиотеками:

  * паттерн ближе к **rule-based / event graph**, а не к деревьям поведения;
  * по сути, «мягкий сценарный движок», который триггерит куски логики при выполнении условий.

---

### 1.4. X4: aiscripts и приказы (orders)

Самый жирный кусок информации даёт мод **KUDA / DeadAir Attack AI Tweaks**:

**Факты**

* Мод не переписывает всё, а накручивает дополнительные **behaviours** вокруг базовой Attack-логики:

  * `AVOID` (обход опасных целей),
  * `MOVE TO ENGAGE POSITION`,
  * `STEP FORWARD`,
  * `WITHDRAW`. ([GitHub][5])
* Выбор поведения строго условный: зависит от

  * ранга пилота,
  * процента щитов,
  * числа орудий у противника,
  * относительного DPS и размера целей. ([GitHub][5])
* Автор прямо пишет: «нет случайных действий, только направление уклонения немного рандомно» и что **«ситуации и события диктуют действия кораблей»**. ([GitHub][5])
* Эти поведения накладываются поверх базового `Attack` order и управляются через меню Behaviour/Order. ([GitHub][5])

**Вывод**

* Базовый X4-ИИ + мод = **набор дискретных режимов**, между которыми происходят переходы по условиям (щит < X%, противник high-risk, дистанция не та и т.д.).
* Это практически **конечный автомат**:

  * состояния: *Avoid → MoveToEngage → Attack → Withdraw*;
  * переходы: условия по щитам, соотношению угрозы, числу союзников и т.д. ([GitHub][5])
* Никакого DSL под BT не видно: архитектура — **XML-скрипты с условиями и переходами**, а не узлы типа Selector/Sequence как в классических BT. ([GitHub][6])

---

## 2. Какие паттерны реально используются (по косвенным признакам)

Теперь то, ради чего ты спрашивал: **классификация по паттернам**.

### 2.1. Finite State Machines (FSM) / иерархические FSM

**Факты**

* Скрипты команд X2/X3 — маленькие врапперы, переадресующие в общие `std`-скрипты. ([Xfiles][1])
* Поведение типа `Attack all enemies`, `Patrol`, `Escort` реализовано как циклы, в которых:

  * выбирается цель (`find nearest enemy`),
  * выполняется последовательность действий (подлет, атака, отход, возврат). ([forum.egosoft.com][7])
* В X4 моды описывают набор «режимов атаки», между которыми корабль переключается по условиям. ([GitHub][5])

**Вывод**

* На уровне «один корабль» это **иерархический конечный автомат**:

  * «верхний» уровень — текущий приказ (order): *Attack*, *Escort*, *Patrol*, *Mine*, *Trade*;
  * внутри каждого ордера — свои подрежимы: *Approach*, *AttackRun*, *Withdraw*, *Avoid*, *Idle*;
  * плюс иногда вложенные FSM (например, под-логика для против станций / против кораблей, как в KUDA). ([GitHub][5])
* Такая структура отлично совпадает с классической историей: **ранние FSM → разрастание → иерархические FSM**, о которых пишут в обзорах BT/FSM для игр и роботов. ([ScienceDirect][8])

**Гипотеза**

* Внутри C++-движка (там, где навигация, избегание столкновений и т.п.) почти наверняка тоже FSM/режимы, просто мы их видим только через скриптовую оболочку.

---

### 2.2. Behaviour Trees (BT)

**Факты**

* В официальной документации по MSCI и MD нет ни слова про поведенческие деревья, узлы Selector/Sequence, тикер, т.п. ([Xfiles][1])
* Скриптовые языки Egosoft описываются как:

  * MSCI: линейный код с условиями и циклами;
  * MD: XML-кусы `cue/condition/action`, библиотеки, но опять же, без терминологии BT. ([Xfiles][1])
* Моддеры, которые выкладывают туториалы по AI, говорят о скриптах, AL-плагинах, MD, но не упоминают внутриигровые BT как отдельный слой.

**Вывод**

* Никаких следов «настоящих» BT в X-серии **не видно**:

  * ни в скриптовой модели;
  * ни в словаре документации;
  * ни в модах/гайдах.
* С высокой вероятностью Egosoft использует **FSM + сложные условия**, а не BT-движок.

**Гипотеза**

* Теоретически могли бы быть какие-то внутриигровые BT в закрытой части движка (например, для пилота-NPC), но:

  * скриптовый и моддерский слой никак их не экспонирует;
  * архитектура вокруг (MSCI, MD) явно заточена под другое.
* Поэтому для практического моделирования «как у X» можно смело считать, что **BT там нет**.

---

### 2.3. Utility AI / «утилити»-паттерны

**Факты**

* KUDA/DeadAir Tweaks вводит:

  * расчёт **«опасных врагов»** на основе чисел: размер, число турелей, DPS, отношение к силе атакующей группы. ([GitHub][5])
  * решения вида: «если shield < X% и враг high-risk → WITHDRAW; если щиты полные и враг не high-risk → ATTACK» и разные пороги для разных рангов пилотов. ([GitHub][5])
* Автор подчёркивает, что действия **детерминированы условиями**; рандом — только в сторону уклонения. ([GitHub][5])

**Вывод**

* Это **не классический Utility AI в смысле непрерывных скоров/аргмакса**.
* Но это **очень утилитарная логика**:

  * оценка риска/выгоды через несколько числовых параметров;
  * разные пороги для «тупых» и «умных» пилотов;
  * по сути, «utility-функция, порезанная на if-ы».

**Гипотеза**

* Базовый ИИ X4, скорее всего, также использует кучу числовых эвристик (дистанции, угол, сила противника) — просто реализованных как цепочки условий.
* Если ты хочешь «поведение как в X», то **модель «FSM с пороговыми утилити-эвристиками» будет ближе всего к правде**.

---

### 2.4. GOAP / планирование

**Факты**

* В документации и модах Egosoft нигде не упоминают планировщики в духе GOAP.
* Патрули, ответные флоты, расовая война и т.п. реализованы через AL-плагины, которые сами итерируют список объектов, создают флоты, отдают приказы, а не через автоматическое планирование. ([xdownloads.co.uk][9])

**Вывод**

* Никаких признаков GOAP-подобного планирования нет:

  * решения жёстко прошиты в скриптах/MD,
  * нет универсального «планировщика целей», по крайней мере на уровне, доступном моддерам.

---

## 3. Как это всё сложить в общую картину

Если сжать всё до схемы по уровням, получается примерно так:

1. **Движок (C++):** физика, навигация, коллизии, pathfinding, внутренняя модель кораблей.
2. **Скриптовый слой управления:**

   * X2/X3: MSCI для команд кораблей и AL-плагинов. ([Xfiles][1])
   * X4: XML-aiscripts, но концептуально очень близко (orders + behaviours). ([forum.egosoft.com][10])
3. **Миссионный / эвент-слой:**

   * Mission Director (MD) — XML, cues-conditions-actions, библиотеки. ([egosoft.com][3])
4. **Глобальные AI-«сервисы»:**

   * AL-плагины / MD-скрипты, которые создают флоты, организуют войны, экономику и т.д. ([xdownloads.co.uk][9])

**Паттерны по слоям:**

* **Корабль / приказ:** иерархический конечный автомат + эвристики.
* **Миссии / ивенты:** ECA-граф (Mission Director).
* **Мир / фракции:** набор периодических сервисов (AL/MD-скрипты).
* **Никаких явных BT/GOAP** — только FSM и правила, с примесями «утилити» через числовые пороги.

---

## 4. Что это значит для тебя (прикладной вывод)

Если ты хочешь **сделать у себя «как в X-серии»**, то:

1. **Базовый паттерн:**

   * делай **Orders** (Attack, Escort, Patrol, Trade, Mine…),
   * внутри каждого — **подсостояния** (*Approach, Attack, Withdraw, Avoid, Idle*),
   * переходы по условиям (дистанция, щиты, относительная мощь, события).

2. **Над кораблями:**

   * отдельные **«сервисы мира»** (как AL-плагины), которые:

     * сканируют вселенную,
     * создают/распускают флоты,
     * выдают ордера кораблям.

3. **Миссии и скриптовые события:**

   * делай **ECA-графы**: «cue → conditions → actions»,
   * с библиотеками шаблонных кусочков летания/спауна/диалогов.

4. **Utility-логика:**

   * не городи полноценный Utility AI, если хочешь именно «как X»,
   * но активно используй **пороговые эвристики**:

     * если `shield < A` и `enemyDPS > k * myDPS` → Withdraw;
     * если `enemiesAround < N` и `shield > B` → Attack;
     * варьируй пороги по «скиллу пилота», как в KUDA. ([GitHub][5])

Если хочешь, дальше можем разобрать **конкретную схему FSM для приказа Attack/Patrol** «в стиле X4» и свернуть её под твою архитектуру U01 — уже без розовых очков, а с чёткими состояниями и условиями.

[1]: https://www.xfiles.chaos.net.nz/MSCIHandbook.pdf "The X² MSCI Programmer's Handbook"
[2]: https://forum.egosoft.com/viewtopic.php?t=105316&utm_source=chatgpt.com "How do you find the Artificial Life settings? - egosoft.com"
[3]: https://egosoft.com/download/x_rebirth/files/XRMissionDirectorGuide.pdf?utm_source=chatgpt.com "MISSION DIRECTOR GUIDE - EGOSOFT"
[4]: https://forum.egosoft.com/viewtopic.php?t=222578&utm_source=chatgpt.com "[Tutorial] Mission Director basics - using libraries - egosoft.com"
[5]: https://github.com/kuertee/x4-mod-da-ku-ai-tweaks "GitHub - kuertee/x4-mod-da-ku-ai-tweaks: deadairaitweaks + kuertee attack ai tweaks"
[6]: https://github.com/kuertee/x4-mod-da-ku-ai-tweaks/blob/master/deadairaitweaks-read-me.md?utm_source=chatgpt.com "x4-mod-da-ku-ai-tweaks/deadairaitweaks-read-me.md at master - GitHub"
[7]: https://forum.egosoft.com/viewtopic.php?t=417928&utm_source=chatgpt.com "Scripting Advice X3:AP - egosoft.com"
[8]: https://www.sciencedirect.com/science/article/pii/S0921889022000513?utm_source=chatgpt.com "A survey of Behavior Trees in robotics and AI"
[9]: https://www.xdownloads.co.uk/index.php?Itemid=116&catid=55&option=com_jdownloads&view=category&utm_source=chatgpt.com "Artificial Life - xdownloads.co.uk"
[10]: https://forum.egosoft.com/viewtopic.php?p=5288324&utm_source=chatgpt.com "AI Script Error in fight.attack.object.capital - egosoft.com"
